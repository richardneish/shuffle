<!doctype html>
<!--<html lang="en" manifest="offline.manifest">-->
<html lang="en" manifest="offline.manifest">
<head>
    <meta charset="utf-8" />
    <title>Shuffle letters</title>
    <link rel="stylesheet" href="lib/1/jquery-ui.css" />
    <script src="lib/1/jquery-1.10.2.min.js"></script>
    <script src="lib/1/jquery-ui.js"></script>
    <script src="lib/1/jquery.ui.touch-punch.min.js"></script>
    <style>
        #shuffle { list-style-type: none; margin: 0; padding: 0; width: 450px; }
        #shuffle li { margin: 3px 3px 3px 0; padding: 1px; float: left; width: 20px; height: 20px; text-align: center; }
        #selected {}
    </style>
    <script>
        function knuth_shuffle(a) {
            var arr = new Array(a.length)
            for (var i = 0; i < a.length; i++) {
                arr[i] = a[i]
            }
            var n = arr.length,
                    r,
                    temp;
            while (n > 1) {
                r = Math.floor(n * Math.random());
                n -= 1;
                temp = arr[n];
                arr[n] = arr[r];
                arr[r] = temp;
            }
            return arr.join('');
        }

        $(function() {
            var input = document.querySelector("#input");
            var shuffle = document.querySelector("#shuffle");
            input.onkeyup = function(event) {
               // Update the shuffle tiles.
                var s = event.target.value;
                // Remove all current letters from the shuffle.
                $(shuffle).empty()

                // Add the letters of the current string.
                for (var i = 0; i < s.length; i++) {
                  $('<li class="ui-state-default">' + s[i] + 
                    ' <input type="checkbox" class="shuffle-lock"></li>').appendTo(shuffle);
                }
                $('.shuffle-lock').onclick = function(event) {
                  $(event.target.parentNode()).toggleClass('shuffle-locked')
                }

                $("#shuffle").sortable({
                  axis: 'x',
                  containment: 'parent',
                  placeholder: 'ui-state-highlight',
                  items: ":not(.shuffle-locked)",
                  start: function(){
                    $(".shuffle-locked", this).each(function(){
                      var $this = $(this);
                      $this.data("pos", $this.index());
                    });
                  },
                  change: function(){
                    $sortable = $(this);
                    $statics = $(".shuffle-locked", this).detach();
                    $helper = $('<li></li>').prependTo(this);
                    $statics.each(function(){
                      var $this = $(this);
                      var target = $this.data('pos');

                      $this.insertAfter($('li', $sortable).eq(target));
                    });
                    $helper.remove();
                  },
                  update: function(event, ui) {
                    // When the user sorts the letters, reflect the new order in the input element.
                    var liList = document.querySelectorAll('#shuffle li');
                    var newString = '';
                    for (var i = 0; i < liList.length; ++i) {
                      newString += liList[i].textContent;
                    }
                    input.value = newString;
                  }
                });
                $("#shuffle").disableSelection();
            };
            document.querySelector("#doShuffle").onclick = function(event) {
                input.value = knuth_shuffle(input.value);
                input.onkeyup({target: input});
            }
        });
    </script>
</head>
<body>
<input id="input" type="text" value=""/>
<button id="doShuffle">Shuffle</button> 2142
<div><ul id="shuffle"></ul></div>
</body>
</html>
